<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>service Package</title>
  <%- include('../../partials/headlink.ejs') %>
</head>

<body>
  <%- include('../../partials/Header.ejs') %>
    <%- include("../../partials/sidebar.ejs") %>
      <main id="main" class="main">
        <div class="pagetitle">
          <h1><%-user.type %></h1>
          <nav>
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="/">Home</a></li>
              <li class="breadcrumb-item active">Dashboard</li>
            </ol>
          </nav>
        </div>
        <!-- End Page Title -->
        <section class="section dashboard">
          <div class="row">
            <div class="row">
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title">Package Edit</h5>

                    <form class="needs-validation row g-3" action="/Create-Package?saloonId=<%=query.saloonId%>"
                      method="post" novalidate>

                      <div class="col-md-6">
                        <label for="">Title Name</label>
                        <input type="text" name="PackageName" class="form-control"
                          placeholder="Enter Package Title Name" value="<%=data?.PackageName %>" required>
                        <div class="invalid-feedback">Please Enter Title Name.</div>
                      </div>

                      <!-- <div class="col-md-6">
                        <label for="">Package Code</label>
                        <input type="text" name="CouponCode" class="form-control" placeholder=" Enter CouponCode"
                          value="<%=data?.CouponCode %>" required>
                        <div class="invalid-feedback">Please Enter Package Code.</div>
                      </div> -->
                      <%console.log("datafa",data)%>
                        <div class="col-md-6">
                          <label for="">Select Cotegory</label>
                          <select class="form-select" name="PackageCotegory" aria-label="Default select example"
                            required="">
                            <option value="">Select Type</option>
                            <% for(Categor of Category){%>
                              <option value="<%= Categor?._id%>"
                                <%=Categor?._id.toString()===data?.PackageCotegory.toString() ? "selected" : "" %>>
                                <%= Categor?.Name%>
                              </option>
                              <%}%>
                          </select>
                        </div>

                        <div class="col-md-6">
                          <label for="">Select Gender</label>
                          <select class="form-select" name="gender" aria-label="Default select example"
                            onchange="FindService(this)" required="">
                            <option value="">Select Type</option>
                            <option value="male" <%=data?.gender==="male" ? "selected" :"" %>>male</option>
                            <option value="female" <%=data?.gender=='female' ? "selected" :"" %> >female</option>
                          </select>
                        </div>

                        <!-- <div class="col-md-6">
                        <label for="">End Date</label>
                        <input placeholder="Enter ending date" name="EndDate" type="date" id="endingDate"
                          class="form-control datepicker" value="<%=data?.EndDate %>" data-date-format="DD-MMMM-YYYY"
                          required>
                        <div class="invalid-feedback">Please Enter End Date.</div>
                      </div> -->

                        <div id="myselect" class="col-md-6"> </div>

                        <!-- <div class="col-md-6">
                        <label for="">Select Service</label>
                        <select class="form-select" name="type" aria-label="Default select example" required="">
                          <option value="">Select Type</option>
                          <% for(Categor of Category){%>
                            <option value="<%= Categor?._id%>" <%=Categor?._id.toString()===Categor?._id.toString()
                              ? "selected" : "" %>>
                              <%= Categor?.Name%>
                            </option>
                            <%}%>
                        </select>
                      </div> -->

                        <!-- <div class="col-md-6">
                        <label for="">Package Limit</label>
                        <input type="number" name="Limit" min="1" max="5" value="<%=data?.Limit %>" class="form-control"
                          placeholder="Enter Limit" required>
                        <div class="invalid-feedback">Please Enter Limit.</div>
                      </div> -->

                        <div class="col-md-6">
                          <label for="">Amount</label>
                          <input type="number" name="Amount" id="Amount" value="<%=data?.Amount %>" class="form-control"
                            placeholder="Enter Amount" required readonly>
                          <div class="invalid-feedback">Please Enter Amount.</div>
                        </div>

                        <div class="col-md-6">
                          <label for="">final Price</label>
                          <input type="number" name="finalPrice" value="<%=data?.finalPrice %>" class="form-control"
                            placeholder="Enter final Price" required>
                          <div class="invalid-feedback">Please Enter final Price.</div>
                        </div>

                        <div class="text-center">
                          <button type="submit" class="btn btn-primary">Submit</button>
                        </div>

                    </form><!-- End No Labels Form -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
      <%- include("../../partials/script.ejs") %>
        <script type="text/javascript">

          $(document).ready(function () {
            let elel = document.getElementById("category")
            let elel2 = document.getElementById("requiredStatus")
            clickMe(elel)
            if (requiredStatus.value == "selected") {
              findAllSaloon(requiredStatus)
            }
          });


          function FindService(select) {
            // console.log("hiiih",select)
            // <% console.log("hhhhhgfggg", query) %>
            let num = Number(select.id)
            let category = select.value
            $.ajax({
              type: 'get',
              data: { "type": category, },
              url: '/Find-Service-for-Packages?saloonId=<%=query.saloonId%>',// nandlal
              success: function (data) {
                if (data.length > 0) {
                  console.log("data", data)
                  let abc = `<div id="subcategory-${num + 1}"><label for="inputAddress" class="form-label">Sub Category</label>`
                  abc += `<select style="width:100%;"  multiple class="form-select" id="txtSelectedValues"  onchange="ServicePriceTotel(this)" name="Services" id="${num + 1}">`
                  abc += `<option value="" disabled>select Sub Category</option>`
                  console.log("abz--", 1, abc)
                  data.forEach((item) => {
                    abc += `<option value=${JSON.stringify({ id: item._id, amount: item.ServicePrice })}>${item.ServiceName}</option>`
                  })
                  abc += `</select> 
                  <div class="invalid-feedback">Please Select Sub Category.</div> </div>`
                  let num2 = num + 1
                  console.log("abz--", 2, abc)
                  while (true) {
                    let cat = $(`#subcategory-${num2}`)
                    if (cat.html()) {
                      cat.remove();
                    } else {
                      break;
                    }
                    ++num2
                  }
                  $('#myselect').append(abc)
                } else {
                  alert("data not found")
                }
              }
            })
          }


          function ServicePriceTotel(a) {
            let arr = []
            var selectedValues = $('#txtSelectedValues').val();
            console.log("selectedValues", selectedValues)
            // $("element[attribute-name=attribute-value]")
            selectedValues.forEach(element => {
              // console.log(element);
              let data = JSON.parse(element)
              arr.push(Number(data.amount))
            });
            const sum = arr.reduce((acc, ele) => acc + ele, 0);
            $('#Amount').val(sum)
          }

        </script>
</body>

</html>